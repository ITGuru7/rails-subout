<div id="dashboard">
      <div class="row-fluid">
        <div id="sidebar" class="span3">
            <section id="filters" class="filters">
              <section class="title"><h5>Opportunity Type</h5></section>
              <section class="content">
                <ul>
                  <li ng-repeat="filter in filters" class="filter row-fluid" ng-class="{active: $location.search().opportunity_type == filter.name}"
                     title="{{filter.name}}">
                  <i class="{{filter.icon}}"></i> <a ng-click="setOpportunityTypeFilter(filter)">{{filter.name}}</a>
                  </li>
                </ul>
              </section>
            </section>
            <section id="event_types" class="filters">
              <section class="title"><h5>Event Type</h5></section>
              <section class="content">
                <ul>
                  <li ng-class="{active: $location.search().event_type == 'opportunity_created'}"><a ng-click="setEventType('opportunity_created')">Created</a></li>
                  <li ng-class="{active: $location.search().event_type =='bid_created'}"><a ng-click="setEventType('bid_created')">New Bid</a></li>
                  <li ng-class="{active: $location.search().event_type =='opportunity_bidding_won'}"><a ng-click="setEventType('opportunity_bidding_won')">Bidding Won</a></li>
                  <li ng-class="{active: $location.search().event_type =='opportunity_canceled'}"><a ng-click="setEventType('opportunity_canceled')">Canceled</a></li>
                </ul>
              </section>
            </section>
            <section id="regions">
              <section class="title"><h5>Region</h5></section>
              <section class="content">
                <ul>
                  <li>
                    <select class="span10" ng-model="regionFilter" ng-options="r for r in regions"></select>
                  </li>
                </ul>
              </section>
            </section>
            <section id="companies">
              <section class="title"><h5>Company</h5></section>
              <section class="content">
                <input class="span10" ng-model="companyNameFilter" placeholder="Enter Company Name ..."/>
              </section>
            </section>
            <section id="favorite_companies" ng-show="favoriteCompanies.length > 0">
              <section class="title"><h5>Favorites</h5></section>
              <section class="content">
                <ul ng-show="favoriteCompanies.length <= 5">
                  <li ng-repeat="company in favoriteCompanies">
                    <a ng-click="setFavoriteFilter(company._id)">{{company.name}}</a>
                  </li>
                </ul>

                <select class="span10" ng-model="favoriteFilter" ng-show="favoriteCompanies.length > 5">
                  <option value="">All</option>
                  <option ng-repeat="c in favoriteCompanies" value="{{c._id}}">
                    {{c.name}}
                  </option>
                </select>
              </section>
            </section>
        </div>
        <div class="span9">
           <section id="activities" when-scrolled="loadMoreEvents()">
              <div id="toolbar">
                  <div class="row-fluid">
                      <div class="pull-left span4">
                        <h5 class="filter-title">{{filter.name || "All Events"}}</h5>
                      </div>
                      <div class='pull-right span8 toolbar-buttons'>
                        <div id="search" class="pull-right span6">
                            <input id="search-listing" class="span10" ng-model="query" placeholder="Search listings for..."/>
                            <div class="icon-search"></div>
                        </div>
                        <a href="#modal" class="btn btn-primary pull-right" data-toggle="modal" ng-click="clearOpportunity(); displayNewOpportunityForm()">New Opportunity</a>
                      </div>
                  </div>
              </div>

              <section id="activity-stream">
                <div class="event row-fluid"
                     ng-class="{expanded: event.selected}"
                     ng-repeat="event in events | filter:searchByQuery | filter:searchByFavorite | filter:searchByCompanyName"
                     ng-init="opportunity=event.eventable; actor=event.actor; action=event.action">

                  <div class="event-summary">
                    <span class="span3">
                      <i class="{{opportunity.icon}}"></i>
                      <span class='created-at timeago' relative-time title="{{event.created_at}}">{{event.created_at|date}}</span>
                    </span>
                    <span class="span9">
                      <span class="opportunity-name">
                        <a ng-click="toggleEvent(event)" title="{{opportunity.name}}">
                          {{opportunity.name}}
                        </a>
                      </span>
                      <span class="event-region">{{ALL_REGIONS[opportunity.start_region]}}->{{ALL_REGIONS[opportunity.end_region]}}</span>
                      <span class="event-action">
                        {{actionDescription(action)}}
                      </span>
                      <a href="#modal" data-toggle="modal" ng-click="setOtherCompanyViaId(actor._id); setModal('partials/company-profile.html')">{{actor.abbreviated_name}}</a>

                      <div class="pull-right expand-collapse">
                        <span class="reference-number" ng-show="event.selected">#{{event.eventable.reference_number}}</span>
                        <i ng-click="toggleEvent(event)" title="{{{true: 'Collapse'}[event.selected] || 'Expand'}}" ng-class="{true: 'icon-large icon-caret-down'}[event.selected] || 'icon-large icon-caret-right'"></i>
                      </div>
                    </span>
                  </div>
                  <div class="eventable-details" ng-show="event.selected" class="action-buttons">
                    <div class="offset3 span5">
                      <div>
                        <p class="description">{{event.eventable.description}}</p>
                      </div>

                      <div>
                        <span>Departs:</span> {{event.eventable.start_date|date}} </br>
                        <span>Arrives:</span> {{event.eventable.end_date|date}}
                      </div>

                      <div>
                        <span>Created by:</span> {{event.actor.name}} </br>
                        <span>Created on:</span> {{event.created_at|date}}
                      </div>

                      <div>
                        <span>Bidding Ends:</span> 
                        <span ng-class='{relative_time:event.eventable.bidding_ends_at}' title="{{event.eventable.bidding_ends_at}}">{{event.eventable.bidding_ends_at|date}}</span>
                        </br>
                        <div ng-show="event.eventable.quick_winnable">
                          <span>Buy now:</span> ${{event.eventable.win_it_now_price}}
                        </div>
                      </div>

                      <div class="actions" ng-show="company.canBidOn(opportunity)">
                        <a href="#modal" class="btn btn-success btn-small" data-toggle="modal" ng-click="displayNewBidForm(opportunity)">Bid</a>
                        <a class="btn btn-success btn-small" ng-show="opportunity.quick_winnable" ng-click="winOpportunityNow(opportunity)">Win Now</a>
                      </div>
                      <a href="#/opportunities/{{event.eventable.reference_number}}">See more...</a>
                    </div>
                    <div class="span4">
                      <a rel="lightbox" href="{{event.eventable.large_image_url}}" title="{{event.eventable.name}}">
                        <img ng-src="{{event.eventable.image_url}}" />
                      </a>
                    </div>
                  </div>
                </div>
              </section>
            <div class="load-more" ng-hide="noMoreEvents">
              <span ng-show="loading">Loading...</span>
            </div>
          </section>
        </div>
      </div>
</div>
