<div id="dashboard">
      <div class="row-fluid">
        <div id="sidebar" class="span3 filters">
            <section id="filters">
              <section class="title"><h5>Opportunity Type</h5></section>
              <section class="content">
                <ul>
                  <li ng-repeat="filter in filters" class="filter row-fluid" ng-class="{active: $location.search().opportunity_type == filter.name, red: filter.active_red}"
                     title="{{filter.name}}">
                  <i class="{{filter.icon}}"></i> <a ng-click="setOpportunityTypeFilter(filter.name)">{{filter.name}}</a>
                  </li>
                </ul>
              </section>
            </section>
            <section id="event_types" class="filters">
              <section class="title"><h5>Event Type</h5></section>
              <section class="content">
                <ul>
                  <li class="filter" ng-class="{active: $location.search().event_type == 'opportunity_created'}"><a ng-click="setEventType('opportunity_created')">New Opportunities</a></li>
                  <li class="filter" ng-class="{active: $location.search().event_type =='bid_created'}"><a ng-click="setEventType('bid_created')">Recent Bids</a></li>
                  <li class="filter" ng-class="{active: $location.search().event_type =='opportunity_bidding_won'}"><a ng-click="setEventType('opportunity_bidding_won')">Recently Won</a></li>
                  <li class="filter" ng-class="{active: $location.search().event_type =='opportunity_canceled'}"><a ng-click="setEventType('opportunity_canceled')">Cancellations</a></li>
                </ul>
              </section>
            </section>
            <section id="regions">
              <section class="title"><h5>Region</h5></section>
              <section class="content">
                <select ui-select2 class="span10" data-placeholder="-- Select Region --" ng-model="regionFilter">
                  <option value=""></option>
                  <option ng-repeat="r in regions" value={{r}} data-abbreviated_name="{{r}}">{{r}}</option>
                </select>
                <div class="clearfix"></div>
              </section>
            </section>

            <section id="companies">
              <section class="title"><h5>Company</h5></section>
              <section class="content">
                <select ui-select2 ng-model="companyFilter" data-placeholder="-- Select Company --" class="span10">
                  <option value=""></option>
                  <option ng-repeat="company in companies | orderBy:'name'"  data-abbreviated_name="{{company.abbreviated_name}}" value="{{company._id}}">{{company.name}} ({{company.abbreviated_name}})</option>
                </select>
                <div class="clearfix"></div>
              </section>
            </section>

            <section id="favorite_companies" ng-show="favoriteCompanies.length > 0 && favoriteCompanies.length <= 10">
              <section class="title"><h5>Favorites</h5></section>
              <section class="content">
                <ul>
                  <li class="filter" ng-repeat="company in favoriteCompanies" ng-class="{active: $location.search().company_id == company._id}">
                    <a ng-click="setFavoriteFilter(company._id)">{{company.name}}</a>
                  </li>
                </ul>
              </section>
            </section>
        </div>
        <div class="span9">
           <section id="activities" when-scrolled="loadMoreEvents()">
              <div id="toolbar">
                  <div class="row-fluid">
                      <div class="pull-left span4">
                        <h5 class="filter-title">{{filter.name || "All Events"}}</h5>
                      </div>
                      <div class='pull-right span8 toolbar-buttons'>
                        <div id="search" class="pull-right span6">
                          <input id="search-listing" class="span10" ui-keypress="{13:'fullTextSearch($event)'}" ng-model="query" placeholder="Search listings for..."/>
                            <div class="icon-search"></div>
                        </div>
                        <a href="#modal" class="btn btn-primary pull-right" data-toggle="modal" ng-click="clearOpportunity(); displayNewOpportunityForm()">New Opportunity</a>
                      </div>
                  </div>
                  <div id="pills" class="row-fluid" ng-show="hasAnyFilter()">
                    <div class="pill" ng-show="$location.search().opportunity_type">
                      {{$location.search().opportunity_type}}<button type="button" ng-click="setOpportunityTypeFilter($location.search().opportunity_type)" class="close">×</button>
                    </div>
                    <div class="pill" ng-show="$location.search().event_type">
                      {{eventTypeLabel($location.search().event_type)}}<button type="button" ng-click="setEventType($location.search().event_type)" class="close">×</button>
                    </div>
                    <div class="pill" ng-show="$location.search().region">
                      {{$location.search().region}}<button type="button" ng-click="regionFilter=null" class="close">×</button>
                    </div>
                    <div class="pill" ng-show="$location.search().company_id">
                      {{companyName($location.search().company_id)}}<button type="button" ng-click="companyFilter=null" class="close">×</button>
                    </div>
                    <div class="pill" ng-show="$location.search().q">
                      {{$location.search().q}}<button type="button" ng-click="query=null;fullTextSearch()" class="close">×</button>
                    </div>
                    <a class="clear-filters" ng-click="clearFilters()">
                      Clear All
                    </a>
                  </div>
              </div>

              <section id="activity-stream">
                <div class="event row-fluid"
                     ng-class="{expanded: event.selected, owner: event.actor._id == company._id}"
                     ng-repeat="event in events"
                     ng-init="opportunity=event.eventable; actor=event.actor; action=event.action">

                  <div class="event-summary">
                    <span class="span3">
                      <i class="{{opportunity.icon}}"></i>
                      <span class='created-at timeago' relative-time title="{{event.created_at}}">{{event.created_at|date}}</span>
                    </span>
                    <span class="span9">
                      <span class="opportunity-name">
                        <a ng-click="toggleEvent(event)" title="{{opportunity.name}}">
                          {{opportunity.name}}
                        </a>
                      </span>
                      <span class="event-region">{{ALL_REGIONS[opportunity.start_region]}}->{{ALL_REGIONS[opportunity.end_region]}}</span>
                      <span class="event-action">
                        {{actionDescription(action)}}
                      </span>
                      <a href="#modal" data-toggle="modal" ng-click="displayCompanyProfile(actor._id)"></a>

                      <div class="pull-right expand-collapse">
                        <a class="reference-number" ng-click="refNumSearch(event.eventable.reference_number)">#{{event.eventable.reference_number}}</a>
                        <i ng-click="toggleEvent(event)" title="{{{true: 'Collapse'}[event.selected] || 'Expand'}}" ng-class="{true: 'icon-large icon-caret-down'}[event.selected] || 'icon-large icon-caret-right'"></i>
                      </div>
                    </span>
                  </div>
                  <div class="eventable-details" ng-show="event.selected" class="action-buttons">
                    <div class="offset3 span5">
                      <div class="description">
                        <div><strong>Description</strong></div>
                        <div class="content">{{event.eventable.description}}</div>
                      </div>
                      <div class="winner" ng-show="event.eventable.winning_bid_id">
                        <span class="label-field">Winner: </span>{{event.eventable.winner.name}} <br />
                        <span class="label-field">Winning Amount: </span> <span ui-currency ng-model="event.eventable.winner.amount"></span>
                      </div>
                      <div>
                        <span>Departs:</span> {{event.eventable.start_date|date}} {{event.eventable.start_time}}<br />
                        <span>Arrives:</span> {{event.eventable.end_date|date}} {{event.eventable.end_time}}
                      </div>
                      <div>
                        <span>Created on:</span> {{event.eventable.created_at|date}}
                      </div>

                      <div>
                        <div ng-hide="event.eventable.winning_bid_id">
                          <span>Bidding Ends:</span>
                          <span ng-class='{relative_time:event.eventable.bidding_ends_at}' title="{{event.eventable.bidding_ends_at}}">{{event.eventable.bidding_ends_at|date}}</span>
                          <div ng-show="event.eventable.quick_winnable">
                            <span>Buy now:</span> ${{event.eventable.win_it_now_price}}
                          </div>
                        </div>
                      </div>
                      <div ng-show="company.isLicensedToBidOnOpportunityOf(event)">
                        <div ng-show="opportunity.buyer_id != company._id && opportunity.status == 'In progress'">
                          <div>
                            <a href="#modal" class="btn btn-success btn-small" data-toggle="modal" ng-click="displayNewBidForm(opportunity)">Bid</a>
                          </div>
                          <span>
                            <a class="btn btn-success btn-small" ng-show="opportunity.quick_winnable" ng-click="winOpportunityNow(opportunity)">Win Now</a>
                          </span>
                        </div>
                        <div>
                          <a href="#/opportunities/{{event.eventable.reference_number}}">See more...</a>
                        </div>
                      </div>
                      <div ng-hide="company.isLicensedToBidOnOpportunityOf(event) || opportunity.status != 'In progress'"">
                        <a href="http://subout.com/pricing/">You are not licensed to bid on this opportunity. Upgrade now! </a>
                      </div>
                    </div>
                    <div class="span4">
                      <a ng-show="event.eventable.image_url && !isOldBrowser" rel="lightbox" href="{{event.eventable.large_image_url}}" title="{{event.eventable.name}}">
                        <img ng-src="{{event.eventable.image_url}}" />
                      </a>
                      <a ng-show="event.eventable.image_url && isOldBrowser"  href="{{event.eventable.large_image_url}}" title="{{event.eventable.name}}" target="_blank">
                        <img ng-src="{{event.eventable.image_url}}" />
                      </a>
                    </div>
                  </div>
                </div>
              </section>
            <div class="load-more" ng-hide="noMoreEvents">
              <span ng-show="loading">Loading...</span>
            </div>
          </section>
        </div>
      </div>
</div>
