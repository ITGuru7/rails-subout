<div id="subout-navbar" class="navbar">
  <div class="navbar-inner">
    <a class="brand" href="#">SubOut</a>
    <ul class="nav">
      <li class="active"><a href="#/dashboard">Home</a></li>
      <li><a href="#modal" data-toggle="modal" ng-click="setModal('partials/bids.html')">My Bids</a></li>
      <li><a href="#modal" data-toggle="modal" ng-click="setOpportunities(); setModal('partials/opportunities.html')">My Opportunities</a></li>
    </ul>
    <div class="btn-group pull-right navbar-buttons">
      <a href="#modal" class="btn btn-inverse" data-toggle="modal" ng-click="setModal('partials/settings.html')"><i class="icon-wrench"></i>Settings</a>
      <a class="btn btn-inverse" ng-click="signOut()"><i class="icon-off"></i>Sign Out</a>
    </div>
  </div>
</div>

<div id="content">
  <div id="dashboard">
        <div class="row-fluid">
          <div id="sidebar" class="span3">
              <section id="filters">
                  <section class="title"><h5>Filters</h5></section>
                  <section class="content">
                      <ul>
                          <li ng-repeat="filter in filters" class="filter row-fluid" style="background:{{filter.color}}" ng-class="{active: filter.active==true,noneactive: filter.active==false}" title="{{filter.name}}"  ng-click="setFilter(filter)">
                              <div class="filter-icon"><img ng-src="{{filter.icon}}" /></div>
                              <div class="filter-name"><div class="name">{{filter.name}}</div></div>
                          </li>
                      </ul>
                  </section>
              </section>
              <section id="tags">
                  <section class="title"><h5>Tags</h5></section>
                  <section class="content">
                      <ul>
                          <li ng-repeat="tag in tags" class="tag" ng-class="{label: tag.active==true}"  title="{{tag.name}}" ng-click="setTag(tag)">
                              {{tag.name}}
                          </li>
                      </ul>
                  </section>
              </section>
          </div>
          <div class="span9">
             <section id="activities">
                <div id="toolbar">
                    <div class="row-fluid">
                        <div class="pull-left span4">
                          <h5 class="filter-title">{{filter.name || "All Listings"}}</h5>
                        </div>
                        <div class='pull-right span8 toolbar-buttons'>
                          <div id="search" class="pull-right span6">
                              <input id="search-listing" class="span10" ng-model="query" placeholder="Search listings for..."/>
                              <div class="icon-search"></div>
                          </div>
                          <a href="#modal" class="btn btn-primary pull-right" data-toggle="modal" ng-click="setModal('partials/opportunity-form.html')">New Opportunity</a>
                        </div>
                    </div>
                </div>

                <table class="table">
                  <tr class="event" ng-repeat="event in events | filter:query |filter:searchByFilter | filter:searchByTag | limitTo:20">
                      <td>
                        <div ui-if="event.type=='opportunity_canceled'" ng-init="opportunity=event.eventable">
                          <div class="row-fluid">
                            <div class="span1"><img ng-src="/img/events/canceled.png"></div>
                            <div class="span11">
                              <div class="left">
                                <div class="row-fluid">
                                  <div class="span8">
                                    <h3 class='title'><a href="#modal" data-toggle="modal" ng-click="setOpportunity(opportunity); setModal('partials/opportunity-detail.html')">{{opportunity.name}}</a></h3>
                                    <div class='buyer'>Canceled by
                                      <span class='buyer-name'><a href="#modal" data-toggle="modal" ng-click="setOtherCompanyViaId(event.actor._id); setModal('partials/company-profile.html')">{{event.actor.name}}</a></span>
                                      <span class='created-at timeago' relative-time title="{{event.created_at}}">{{event.created|date}}</span>
                                    </div>
                                  </div>
                                </div><!--.row-fluid-->
                              </div>
                            </div>
                          </div>
                        </div>

                        <div ui-if="event.type=='opportunity_updated'" ng-init="opportunity=event.eventable">
                          <div class="row-fluid">
                            <div class="span1"><img ng-src="/img/events/updated.png"></div>
                            <div class="span11">
                              <div class="left">
                                <div class="row-fluid">
                                  <div class="span8">
                                    <h3 class='title'><a href="#modal" data-toggle="modal" ng-click="setOpportunity(opportunity); setModal('partials/opportunity-detail.html')">{{opportunity.name}}</a></h3>
                                    <div class='buyer'>Updated By 
                                      <span class='buyer-name'><a href="#modal" data-toggle="modal" ng-click="setOtherCompanyViaId(event.actor._id); setModal('partials/company-profile.html')">{{event.actor.name}}</a></span>
                                      <span class='created-at timeago' relative-time title="{{event.created_at}}">{{event.created|date}}</span>
                                    </div>
                                  </div>
                                </div><!--.row-fluid-->
                              </div>
                            </div>
                          </div>
                        </div>

                        <div ui-if="event.type=='opportunity_bidding_won'" ng-init="opportunity=event.eventable">
                          <div class="row-fluid">
                            <div class="span1"><img ng-src="/img/events/bidding_won.png"></div>
                            <div class="span11">
                              <div class="left">
                                <div class="row-fluid">
                                  <div class="span8">
                                    <h3 class='title'><a href="#modal" data-toggle="modal" ng-click="setOpportunity(opportunity); setModal('partials/opportunity-detail.html')">{{opportunity.name}}</a></h3>
                                    <div class='buyer'>Won By 
                                      <span class='buyer-name'><a href="#modal" data-toggle="modal" ng-click="setOtherCompanyViaId(event.actor._id); setModal('partials/company-profile.html')">{{event.actor.name}}</a></span>
                                      <span class='created-at timeago' relative-time title="{{event.created_at}}">{{event.created|date}}</span>
                                    </div>
                                  </div>
                                </div><!--.row-fluid-->
                                <div class='description'>Winning Bid Amount ${{opportunity.winning_bid_amount}}</div>
                              </div>
                            </div>
                          </div>
                        </div>

                        <div id="opportunity_{{opportunity._id}}" ui-if="event.type=='opportunity_created'" ng-init="opportunity=event.eventable">
                          <div class="row-fluid">
                            <div class="span1"><img ng-src="{{opportunity.icon_url}}"></div>
                            <div class="span11">
                              <div class="left">
                                <div >
                                  <div class="span8">
                                    <h3 class='title'><a href="#modal" data-toggle="modal" ng-click="setOpportunity(opportunity); setModal('partials/opportunity-detail.html')">{{opportunity.name}}</a></h3>
                                    <div class='buyer'>Offered By 
                                      <span class='buyer-name'><a href="#modal" data-toggle="modal" ng-click="setOtherCompanyViaId(event.actor._id); setModal('partials/company-profile.html')">{{event.initiated_by_name}}</a></span>
                                      <span class='created-at timeago' relative-time title="{{opportunity.created_at}}">{{opportunity.bidding_ends|date}}</span>
                                    </div>
                                  </div>
                                  <div class="span4">
                                    <div class='bidding-ends-on'>
                                      Ending <time class="timeago" relative-time datetime="{{opportunity.bidding_ends}}">{{opportunity.bidding_ends|date}}</time>
                                    </div>
                                  </div>
                                </div>
                                <div class='description'>{{opportunity.description}}</div>
                                <div class="row-fluid">
                                  <div class="span6 data-items">
                                    #bids: <span class='data'>{{opportunity.bids_count}}</span>, 
                                    Latest Bid: <span class='data'>{{opportunity.latest_bid_amount}}</span>,
                                    Lowest Bid: <span class='data'>{{opportunity.lowest_bid_amount}}</span>
                                  </div>
                                  <div class="span6 actions">
                                     <a href="#modal" data-toggle="modal" ng-click="setOpportunity(opportunity); setModal('partials/bid-new.html')">Bid</a> *
                                     <a ui-if="opportunity.quick_winnable" ng-click="winOpportunityNow(opportunity)">Win Now for {{opportunity.win_it_now_price }}</a> *
                                     <a href='#'>Watch</a>
                                   </div><!--.actions-->
                                </div><!--.row-fluid-->
                              </div>
                            </div>
                          </div>
                        </div>

                        <div ui-if="event.eventable_type=='Bid'" ng-init="bid=event.eventable">
                          <div class="row-fluid">
                            <div class="span1"><img ng-src="/img/filters/bid.png"></div>
                            <div class="span11">
                              <div class="left">
                                <div class="row-fluid">
                                  <div class="span8">
                                    <h3 class='title'><a href="#modal" data-toggle="modal" ng-click="setOpportunityViaId(bid.opportunity_id, event.eventable_id); setModal('partials/opportunity-detail.html')">{{bid.opportunity_title}}</a></h3>
                                    <div class='bidder'>
                                      <span class='bidder-name'><a href="#modal" data-toggle="modal" ng-click="setOtherCompanyViaId(event.actor._id); setModal('partials/company-profile.html')">{{event.initiated_by_name}}</a></span>
                                      bid
                                      <span class='bid-amount'>${{bid.formatted_amount}}</span>
                                      <span class='created-at timeago' relative-time title="{{bid.created_at}}">{{bid.created_at|date}}</span>
                                    </div>
                                  </div>
                                  <div class="span4">
                                    <div class='bidding-ends-on'>
                                      Ending <time class="timeago" relative-time datetime="{{bid.opportunity_bidding_ends}}">{{bid.opportunity_bidding_ends|date}}</time>
                                    </div>
                                  </div>
                                </div><!--.row-fluid-->
                              </div>
                            </div>
                          </div>
                        </div>

                      </td>
                  </tr>
                </table>

            </section>

          </div>
        </div>
  </div>
</div>
