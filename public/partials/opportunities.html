<div id="opportunities">
  <div class="row-fluid">
    <div class="welcome display-message top-banner pull-left">
      <span class="display-message-extra">Welcome</span>
      <span class="company display-message-subject">{{company.name}}!</span>
      <span class="display-message sales-info" sales-info-messages="salesInfoMessages"></span>
    </div>
    <div class="search pull-right span4">
      <input ng-model="opportunityQuery" placeholder="Search opportunities for..."/>
      <div class="icon-search"></div>
    </div>
  </div>

  <div class="pull-right" ng-show="maxPage > 1" ng-include="'pagination'"></div>
  
  <table ng-show="!isPhone" class="table">
    <tr>
      <th>Reference #</th>
      <th>Type</th>
      <th>Name</th>
      <th>Description</th>
      <th>
        <a ng-click="sortOpportunities('created_at')">Created</a>
        <i ng-show="sortBy == 'created_at' && sortDirection == 'desc'"  class="icon-large icon-caret-down"></i>
        <i ng-show="sortBy == 'created_at' && sortDirection == 'asc'"  class="icon-large icon-caret-up"></i>
      </th>
      <th>
        <a ng-click="sortOpportunities('bidding_ends_at')">Bidding Ends</a>
        <i ng-show="sortBy == 'bidding_ends_at' && sortDirection == 'desc'"  class="icon-large icon-caret-down"></i>
        <i ng-show="sortBy == 'bidding_ends_at' && sortDirection == 'asc'"  class="icon-large icon-caret-up"></i>
      </th>
      <th>
        <a ng-click="sortOpportunities('start_date')">Departs</a>
        <i ng-show="sortBy == 'start_date' && sortDirection == 'desc'"  class="icon-large icon-caret-down"></i>
        <i ng-show="sortBy == 'start_date' && sortDirection == 'asc'"  class="icon-large icon-caret-up"></i>
      </th>
      <th class="current-bid-amount">Bid Range</th>
      <th>Winning Bidder (Amount)</th>
    </tr>
    <tr ng-repeat="opportunity in opportunities | filter:opportunityFilter" >
      <td>{{opportunity.reference_number}}</td>
      <td>{{opportunity.type}}</td>
      <td><a href="#/opportunities/{{opportunity.reference_number}}">{{opportunity.name}}</a></td>
      <td>{{opportunity.description}}</td>
      <td>
        <span class='created-at timeago' relative-time title="{{opportunity.created_at}}">{{opportunity.created_at|date}}</span>
      </td>
      <td>
        <span class='created-at timeago' relative-time title="{{opportunity.bidding_ends_at}}">{{opportunity.bidding_ends_at|date}}</span>
      </td>
      <td>
        <span class='created-at'>{{opportunity.start_date | stringToDate | date:'MMM dd'}}</span>
      </td>
      <td class="current-bid-amount">
        <span ng-show="opportunity.lowest_bid_amount">
          <span ui-currency ng-model="opportunity.lowest_bid_amount"></span>
          /
          <span ui-currency ng-model="opportunity.highest_bid_amount"></span>
        </span>
      </td>
      <td><span ng-show="opportunity.winner">{{opportunity.winner.name}} (<span ng-show="opportunity.winner.name" ui-currency ng-model="opportunity.winner.amount"></span>)</span></td>
    </tr>
  </table>

  <table ng-show="isPhone" class="table table-border" ng-repeat="opportunity in opportunities | filter:opportunityFilter">
    <tr>
      <td class="table-header reference-number">Reference #</td>
      <td>{{opportunity.reference_number}}</td>
    </tr>
    <tr>
      <td class="table-header">Type</td>
      <td>{{opportunity.type}}</td>
    </tr>
    <tr>
      <td class="table-header">Name</td>
      <td><a href="#/opportunities/{{opportunity.reference_number}}">{{opportunity.name}}</a></td>
    </tr>
    <tr>
      <td class="table-header">Description</td>
      <td>{{opportunity.description}}</td>
    </tr>
    <tr>
      <td class="table-header">Ends</td>
      <td>
        <span class='created-at timeago' relative-time title="{{opportunity.bidding_ends_at}}">{{opportunity.bidding_ends_at|date}}</span>
      </td>
    </tr>
    <tr>
      <td class="table-header">Winning Bidder</td>
      <td>{{opportunity.winner.name}}</td>
    </tr>
    <tr>
      <td class="table-header">Amount</td>
      <td>
        <span ng-show="opportunity.winner.name" ui-currency ng-model="opportunity.winner.amount"></span>
      </td>
    </tr>
  </table>
  <div class="pull-right" ng-show="maxPage > 1" ng-include="'pagination'"></div>
</div>
